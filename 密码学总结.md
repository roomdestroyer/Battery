# 密码学知识点总结

[1. 公钥密码学所基于的数学问题](#1. 公钥密码学所基于的数学问题)

- [整数分解问题](#整数分解问题)
- [离散对数问题](#离散对数问题)
- [椭圆曲线问题](#椭圆曲线问题)

[2. 非对称密码的优缺点](#2. 非对称密码的优缺点)

- [优点](#优点)
- [缺点](#缺点)

[3. 秘钥长度与安全等级](#3. 秘钥长度与安全等级)

[4. RSA 密码体制](#4. RSA 密码体制)

- [基本流程](#基本流程)
- [padding 方案](#padding 方案)

[5. Diffie-Hellman](#5. Diffie-Hellman)

- [算法思想](#算法思想)
- [算法流程](#算法流程)

[6. Elgamal 加密方案](#6. Elgamal 加密方案)

- [基本流程](#Elgamal 基本流程)

[7. 椭圆曲线密码体制](#7. 椭圆曲线密码体制)

- [椭圆曲线的定义](#椭圆曲线的定义)
- [椭圆曲线上的群操作](#椭圆曲线上的群操作)
- [椭圆曲线离散对数问题](#椭圆曲线离散对数问题)

[8. 数字签名](#8. 数字签名)

- [RSA 数字签名方案](#RSA 数字签名方案)
- [Elgamal 数字签名方案](#Elgamal 数字签名方案)
- [数字签名算法](#数字签名算法)
- [椭圆曲线数字签名算法（ECDSA）](#椭圆曲线数字签名算法（ECDSA）)

[9. 哈希函数](#9. 哈希函数)

- [哈希函数的三个特性](#哈希函数的三个特性)
- [生日攻击](#生日攻击)
- [MD4 家族 ](#MD4 家族 )
- [安全哈希算法 SHA-1](#安全哈希算法 SHA-1)

[10. 消息验证码（MAC）](#10. 消息验证码（MAC）)

- [使用哈希的 MAC：HMAC](#使用哈希的 MAC：HMAC)









## 1. 公钥密码学所基于的数学问题

- ##### 整数分解问题

  例如 RSA 方案。给定两个大素数，计算它们的乘积非常容易，但是将它们的乘积分解因式却是非常困难的，如果每个素数对应的十进制数字都超过150位，即使使用数千台PC运行数百年也不可能因式分解得到乘积；

  ##### 攻击手段

  - 协议攻击：利用 RSA 加密的延展性漏洞，但通过 padding 可避免；
  - 数学分析攻击：暴力计算私钥 d，通过选取尽量大的模数可以避免；
  - 旁道攻击：攻击者直接访问 RSA 实现机，如手机或智能卡，利用通过类似功率消耗或计时行为等物理通道泄露的私钥信息，通过在指数0的平方之后执行一个虚拟变量的乘法可以避免。

- ##### 离散对数问题

  例如 Diffie-Hellman 秘钥交换、Elgamal 加密或数字签名算法（DSA）。给定一个 p-1 的有限循环群 Z~p~^*^ ，一个生成元 α ∈ Z~p~^*^ 和另一个元素 β ∈ Z~p~^*^ ，α 的幂可以生成群内任何元素，但如果参数够大，确定满足 α^x^ = β mod p 的 x 在计算上是不可行的。

  ##### 攻击手段

  - 蛮力搜索：计算离散对数平均需要 (p-1)/2 次检测；
  - Shanks 算法：使用额外的存储来节省搜索时间；
  - Pollard's Rho 算法：使用生日悖论的概率算法，伪随机地生成 α^i^ 和 β^i^ 形式的元素，直到产生冲突为止；
  - Pohlig-Hellman 算法：利用中国剩余定理；
  - Index-Calculus 算法：利用群的数学特性。

- ##### 椭圆曲线问题

  例如椭圆曲线 Diffie-Hellman 密钥交换（ECDH）和椭圆曲线数字签名算法（ECDSA）。是离散对数算法的推广。



## 2. 非对称密码的优缺点

- ##### 优点
  
  - 在不安全的信道上建立秘钥交换协议和传输协议；
  - 可以自由管理和分配秘钥；
  - 可以通过数字签名算法（RSA、DSA、ECDSA）实现不可否认性和消息完整性；
  - 可以识别目标身份，防止身份伪造；
  - 可以使用RSA或Elgamal的算法对消息进行加密。
  
- ##### 缺点
  
  - 速度很慢，计算量非常大，比分组密码或者序列密码慢成百上千倍；
  - 不知道某个公钥是否真正来自某人。
  
- 实际的协议通常是混合协议，即对称密码算法和公钥算法的结合，如Web连接的SSL/TLS协议，或作为Internet通信协议的IPsec，且利用数字签名解决公钥与特定实体绑定的问题。



## 3. 秘钥长度与安全等级

如果已知最好的攻击需要 2^n^ 步才能破解某个算法，则这个算法具有 n 位的安全等级。

![image-20220507131823584](https://s2.loli.net/2022/05/07/yQaIhA4u5gL82mT.png)

为了维持较好的安全（几十年的安全），应该至少选择 128 位的安全等级。



## 4. RSA 密码体制

- ##### 基本流程

  RSA 加密和解密都是在整数环 Z~n~ 中进行的，n 是域元素，e 是加密指数，d 是解密指数。![image-20220507134347221](https://s2.loli.net/2022/05/07/YMc5LF8tUirpRuN.png)

![image-20220507193348595](https://s2.loli.net/2022/05/07/7pX8knViOSLDfjo.png)

![image-20220507193359274](https://s2.loli.net/2022/05/07/HdpWl5P3mJkoRtD.png)

- ##### padding 方案

  RSA 总是将特定明文映射到特定密文，攻击者容易从密文中得到一些统计属性，且攻击者可以将一段恶意消息通过公钥 (n, e) 加密后嵌入到密文中篡改消息，因此需要一个填充方案，在加密明文前将一个随机结构嵌入到明文中，并生成哈希摘要附加在结尾，接收方接受时需要先验证加密消息的结构。



## 5. Diffie-Hellman

- ##### 算法思想

  Diffie-Hellman 秘钥交换（DHKE）允许双方通过不安全的信道进行交流，得到一个共同秘钥，许多公开的商业和密码协议都实现了这种基本的秘钥协议技术，比如安全外壳（SSH），传输安全层（TLS）和 Internet 协议安全（IPSec）。

  DHKE 的基本思想：Z<sub>p</sub><sup>*</sup> 内的指数运算（p是素数）是单向函数，并且该指数运算是可交换的：

![image-20220507140604503](https://s2.loli.net/2022/05/07/MaX8HkSK6ThUlDr.png)

- ##### 算法流程

  DHKE 由两个协议组成：握手协议和交换协议：

  ![image-20220507140714887](https://s2.loli.net/2022/05/07/gZXUy2KzcROE8qp.png)

  p 和 α 成为域参数，通信双方根据域参数生成一个联合私钥 k。

  ![image-20220507140722310](https://s2.loli.net/2022/05/07/p2eiojWXcdADrJ9.png)

![image-20220507140913878](https://s2.loli.net/2022/05/07/9wRI6tiDxj7TlcU.png)

如：

![image-20220507141149188](https://s2.loli.net/2022/05/07/1Z6pWILQjlRVXTt.png)



## 6. Elgamal 加密方案

##### Elgamal 基本流程

是 DHKE 的扩展，第一段是古典 DHKE，第二段是消息加密与解密。

![image-20220507143549655](https://s2.loli.net/2022/05/07/jV2IG6qwEfDdKTe.png)



## 7. 椭圆曲线密码体制

- ##### 椭圆曲线的定义

![image-20220507144136364](https://s2.loli.net/2022/05/07/F8PzWY6dtI5RLuZ.png)

##### 椭圆曲线上的群操作

满足上述定义的所有点构成循环群。

![image-20220507144659654](https://s2.loli.net/2022/05/07/Ee6ubZA8pWjBlLo.png)

举例：

![image-20220507144817110](https://s2.loli.net/2022/05/07/tzbW5JP6GwBNe9i.png)

建立好群操作（相异点加法和相同点加法）后，曲线上的所有点构成循环子群定理如下：

##### 椭圆曲线离散对数问题

![image-20220507145144226](https://s2.loli.net/2022/05/07/vJg3eruA8clo9WE.png)

其中，d 是私钥，公钥 T 是曲线上一个点的坐标。

##### Hasses‘s 定理

![image-20220507145342678](https://s2.loli.net/2022/05/07/K9ms48E3ZtPJYGQ.png)



## 8. 数字签名

![image-20220507192351464](https://s2.loli.net/2022/05/07/4EnCalZtIs25rmA.png)

- ##### RSA 数字签名方案

  ![image-20220507193011603](https://s2.loli.net/2022/05/07/tWc4lRifsoYzyPT.png)

  RSA 加密方案使用公钥加密消息，数字签名方案则使用私钥加密消息。

  **区别：**公钥加密，只有私钥持有者才可解密，用于消息传递；私钥加密，任何人都可解密，任何人都可验证发送者的身份。

  **存在性伪造：**攻击者利用公钥对数字签名进行解密，得到使该签名有效的消息 x，并宣称这个 x 才是发送方发送的消息，虽然这个消息实际上是完全随机的。

  **RSA 填充技术：**限制消息具有一定的格式，比如末位有连续100个0，这样可以防止存在性伪造。

  **EMSA 概率签名方案（PSS）：**1. 生成一个随机值 salt；将一个固定填充 padding1、消息哈希值和 salt 连接起来成新的消息 M'；3. 计算 M' 对应的哈希值 H；4. 将一个固定填充 padding2 与 salt 连接起来组成数据块 DB；5. DB 与 H 异或后生成一个掩码 maskedDB；6. 将掩码值与 H和固定填充 bc 串起来，得到编码后的消息 EM。

  ![image-20220507202611214](https://s2.loli.net/2022/05/07/gVbXZ2syhUGH7J5.png)

  验证方会先根据掩码恢复出 salt 值，并检查消息的 EMSA-PSS 编码是否正确

- ##### Elgamal 数字签名方案

  Elgamal 数字签名与 Elgamal 加密方案是完全不同的。

  - 秘钥生成：

    ![image-20220507203457774](https://s2.loli.net/2022/05/07/o86QbVHdiGhC9pZ.png)

  - 签名：（私钥加密）

    ![image-20220507203535345](https://s2.loli.net/2022/05/07/vDXMC8p3OGHSexA.png)

  - 验证：（公钥解密）

    ![image-20220507203818128](https://s2.loli.net/2022/05/07/Vw2BmYbGEOD3RZs.png)

- ##### 数字签名算法

  相比于 RSA 签名和 Elgamal 签名，更常用的是数字签名算法（DSA）。核心思想是使用两个循环群，一个大的一个小的，以此来控制握手阶段产生的签名长度。

  ![image-20220507204540978](https://s2.loli.net/2022/05/07/NqerX9aDT25lGAS.png)

  - 秘钥生成：

    ![image-20220507204143174](https://s2.loli.net/2022/05/07/wRNeaDb15kO4glE.png)

  - 签名：

    ![image-20220507204343523](https://s2.loli.net/2022/05/07/uySDKCLWib8PZ2k.png)

  - 验证：

    ![image-20220507204422387](https://s2.loli.net/2022/05/07/Bme3XvVDYEnMzg7.png)

- ##### 椭圆曲线数字签名算法（ECDSA）

  椭圆曲线方案在更小的位数上可以提供更高的加密等级。ECDSA 标准是针对素数域和伽罗瓦域 GF(2^m^) 上的椭圆曲线定义的。

  - 秘钥生成：

    ![image-20220507204958503](https://s2.loli.net/2022/05/07/MijFkaZofStYD2P.png)

  - 签名：

    ![image-20220507205039724](https://s2.loli.net/2022/05/07/9pE6mOstunDY1ZR.png)

    ![image-20220507205047749](https://s2.loli.net/2022/05/07/mML5PneY9VRNEOJ.png)

  - 验证：

    ![image-20220507205211661](https://s2.loli.net/2022/05/07/qCxP9Q6lLcGN5VY.png)



## 9. 哈希函数

哈希函数对一个长消息生成一个固定长度的消息摘要。

- ##### 哈希函数的三个特性

（1）单向性：给定一个哈希输出 z，找到满足 z = h(x) 的输入消息 x 在计算上是不可行的。

（2）弱抗冲突性：使用一个输入与一个哈希值找到另一个冲突的输入是计算不可行的。

（3）强抗冲突性：不可能找到两个输入具有相同的哈希值。

![image-20220507210147574](https://s2.loli.net/2022/05/07/Mo736tpjK1G4c8f.png)

- ##### 生日攻击

  如果有 40 人参加聚会，其出现生日冲突的概率大概为 90%；

  找到一个冲突所需的哈希的消息的数目大概等于可能输出值个数的平凡根，因此为了实现 `x` 位的安全等级，哈希函数的输出长度必须为 `2x` 位。

- ##### MD4 家族 

  MD5 是 MD4 的加强版，输出为128位，抗冲突性约为 2^64^，若果只需要抗第一原象性和抗第二原象性，MD5 是足够安全的。

  ![image-20220507210844854](https://s2.loli.net/2022/05/07/sAI6jVLimTNF2q8.png)

  ![image-20220507210853012](https://s2.loli.net/2022/05/07/4d9hQBy5KqfXjRr.png)

- ##### 安全哈希算法 SHA-1

  是 MD4 家族中使用最广的函数，允许的最大长度为 2^64^ 位，输出为 160 位。在哈希计算时，先对消息进行预处理，实际计算时，压缩函数将消息分为 512 位的分组进行处理，压缩函数共有 80 轮，这 80 轮可以分成四个分别由 20 轮组成的阶段。

  ![image-20220507211426814](https://s2.loli.net/2022/05/07/RM5TQ23ryzUljDn.png)

  - **预处理：**先将消息长度填充到 512N，分割出每个长度为 512 的子消息，然后将其分割为 16 个大小为 4 字节的单词，将哈希输出置为 5 个 4 字节的单词。

  - **哈希计算：**将一个 512 位的消息拆成 80 个4 字节的单词，具体流程如下：

    ![image-20220507212644400](https://s2.loli.net/2022/05/07/HuJTm8k1rogvXnB.png)

    每个阶段包含 20 轮，在每轮中，函数 f 和某个与阶段无关的常量 K 一起处理一部分消息分组，在 80 轮之后进行后处理，生成 160 位的消息摘要。

    ![image-20220507212711088](https://s2.loli.net/2022/05/07/iX6pW7b4gVaOCyD.png)





## 10. 消息验证码（MAC）

MAC 与数字签名都提供消息完整性和消息验证，但 MAC 是对称秘钥方案，且不提供不可否认性，其优势是它的速度比数字签名快很多，因为 MAC 基于分组密码或哈希函数。

![image-20220507213255845](https://s2.loli.net/2022/05/07/Ohsuk7qjzJiLGBQ.png)

只有拥有相同私钥 k 的双方才可以计算 MAC，攻击者不可以获得秘钥。

- ##### 使用哈希的 MAC：HMAC

  ![image-20220507213517984](https://s2.loli.net/2022/05/07/86Xb9QcHWvR4LzO.png)

  秘钥填充是为了达到哈希函数输入分组的宽度。







